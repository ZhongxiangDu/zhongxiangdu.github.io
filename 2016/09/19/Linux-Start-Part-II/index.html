<!DOCTYPE HTML>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="google-site-verification" content="" />
  
  <title>Linux Start Part II</title>
  <meta name="author" content="Zhongxiang Du">
   <meta name="description" content="As the Linux booting process is very long, the article has talked some prepared work in the Protected Mode and this article will briefly talk about the follow-up work of the booting process.">
  

  <meta property="og:title" content="Linux Start Part II"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:site_name" content="Du&#39;s Blog"/>
 <meta property="og:image" content="undefined"/>
  
  <link href="/apple-touch-icon-precomposed.png" sizes="180x180" rel="apple-touch-icon-precomposed">
  <link rel="alternate" href="/atom.xml" title="Du&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/m.min.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id='wx_pic' style='display:none;'><img src='/wx_share.png'/></div>
  <div id="main">
    <div class="behind">
      <div class="back">
        <a href="/" class="black-color"><i class="fa fa-times" aria-hidden="true"></i></a>
      </div>
      <div class="description">
        &nbsp;
      </div>
    </div>
    <div class="container">
      

  <article class="standard post">
    <div class="title">
      
  
    <h1 class="page-title center">
        Linux Start Part II
    </h1>
  


    </div>
    <div class="meta center">
      
<time datetime="2016-09-19T07:58:00.000Z">
  <i class="fa fa-calendar"></i>&nbsp;
  2016-09-19
</time>



    
    &nbsp;
    <i class="fa fa-tag"></i>&nbsp;
    <a href="/categories/Operation-System/">Operation System</a>




    
    &nbsp;
    <i class="fa fa-tag"></i>&nbsp;
    <a href="/tags/Linux/">Linux</a>·<a href="/tags/Operation-System/">Operation System</a>


    </div>
    <hr>
    <div class="picture-container">
      
    </div>
    <p>As the Linux booting process is very long, the <a href="/2016/09/18/Linux-Start/" title="article">article</a> has talked some prepared work in the <a href="/2016/08/21/Protected-mode-and-Real-mode/" title="Protected Mode">Protected Mode</a> and this article will briefly talk about the follow-up work of the booting process.<a id="more"></a></p>
<h4 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h4><p>After the Head has build the <a href="/2016/09/10/Paging/" title="Paging">Paging</a> system, the kernel will jump to Main, after the part most of the code are writen by C language. In Main, many initiation works are done.</p>
<ol>
<li>Read the computer information in 0x90000~0x901FD stored by Setup.</li>
<li>Set ramdisk, if RAMDISK is defined in Makefile, alloc RAMDISK KB in 0x3FFFFF for ramdisk.</li>
<li>As Linux 0.11 only support 16MB, here define an array mem_map to denote whether the pages denoting 1MB~16MB are used.</li>
<li>Register all the ISR in the <a href="/2016/09/11/IDT-LDT-TSS-and-GDT/" title="IDT">IDT</a>.</li>
<li>Initiate the <a href="/2016/09/18/Buffer-and-Block-Device/" title="Block Device request array">Block Device request array</a>.</li>
<li>Set the serial port, the IRQ3 and IRQ4 of interrupt controller (8259A) is for RS232 serial communication. Initiate the console, setting the information about the monitor. Then, add keyboard ISR. More details please refer to <a href="/2016/09/12/TTY/" title="TTY">TTY</a>.</li>
<li>Read the current time from a CMOS in the mainboard and transfer it into the system start-up time.</li>
<li>Set the current task as process 0, and initiate the zero item in <a href="/2016/09/12/Fork-and-Execve/" title="task[64]">task[64]</a>. Load the current <a href="/2016/09/11/IDT-LDT-TSS-and-GDT/" title="TSS">TSS</a> and <a href="/2016/09/11/IDT-LDT-TSS-and-GDT/" title="LDT">LDT</a> into <a href="/2016/09/11/IDT-LDT-TSS-and-GDT/" title="GDT">GDT</a>.</li>
<li>Register timer interrupt and set interval as 10ms. For more details please refer to <a href="/2016/09/18/Scheduler-and-Timer/" title="Scheduler and Timer">Scheduler and Timer</a>.</li>
<li>Register the system call interrupt, the user process can not access the kernel, but the user need to read file or print information in many cases. So the kernel offers a set of system calls. When user use this functions, it will trigger an interrupt.</li>
<li>Initiate the <a href="/2016/09/18/Buffer-and-Block-Device/" title="Buffer">Buffer</a>.</li>
<li>Initiate the floppy and hard disk. Here, the kernel just simply register the ISR for the device.</li>
<li>Enable the interrupt and jump to the user mode by using the stack.</li>
</ol>
<h4 id="Process-1"><a href="#Process-1" class="headerlink" title="Process 1"></a>Process 1</h4><p>After entering the user mode, the process 0 will <a href="/2016/09/12/Fork-and-Execve/" title="fork">fork</a> process 1. After this, the process 0 will “sleep”(even though process 0 will take part in the scheduling, it will do nothing).</p>
<p>The first work of process 1 is calling the system call sys_setup(this can only be called once) to load the root file system. sys_setup will spend a lot of time to verify the information of the devices. Based on the root device number, read the data from the corresponding data, read the 257,256,258 data blocks. The super block is 257. After verifying the super block, read the whole root file system into 0x3FFFFF, and set it as root device. Initiate the file manage table, file_table[64], so Linux 0.11 can open at most 64 files at the same time. Because after loading the root file system, all the operations to the devices is by <a href="/2016/09/13/File-Operation/" title="File Operation">File Operation</a>. Initiate the super block management table.</p>
<p>Read the super block inode and the file system inode, and add the super block to the super block management table. Because the root file system is in the memory now, these operations will not trigger any interrupts. Set the root directory’s inode as the inode of the root file system. Here the root file system is loaded.</p>
<p>Open the file dev/tty0, which means the console, as this is first opening file operation, the file descriptor must be 0. For more details please refer to <a href="/2016/09/13/File-Operation/" title="File Operation">File Operation</a>. Then copy the file descriptor twice, for stdout and stderr.</p>
<h4 id="Process-2"><a href="#Process-2" class="headerlink" title="Process 2"></a>Process 2</h4><p>Process 1 use system call fork and create process 2. Process 2 inherits all the information from process 1 and close the file descriptor 0 (stdin) and open /etc/rc as input, then execute a shell program and the rc file is the input to the shell program, which start the process <a href="/2016/09/13/File-Operation/" title="update">update</a>. While the shell is running, the process 1 is always waiting.<br>When this shell program is end, process 1 will start a new shell program, at this time it will use the /dev/tty0 as stdin. In this case, we can input the command by the keyboard and start new processes with this commands.</p>


  </article>
  </script>
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
  


<div id="disqus_thread"></div>
<script>

var disqus_config = function () {
this.page.url = 'http://www.duzhongxiang.com/2016/09/19/Linux-Start-Part-II/index.html';
this.page.identifier = undefined;
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//www-duzhongxiang-com.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>



    </div>
  </div>
  <footer class="page-footer"><div class="clearfix">
</div>
<div class="right-foot container">
    <div class="firstrow">
        <a href="#top" >
        <i class="fa fa-arrow-right"></i>
        </a>
        © Zhongxiang Du  2016-2017
    </div>

</div>
<div class="clearfix">
</div>
</footer>
  <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script src="/js/search.js"></script>
<script type="text/javascript">

// comments below to disable loading animation
function revealOnScroll() {
  var scrolled = $(window).scrollTop();
  $(".excerpt, .index-title, .index-meta, p").each(function() {
    var current = $(this),
      height = $(window).outerHeight(),
      offsetTop = current.offset().top;
    (scrolled + height + 50 > offsetTop) ? current.addClass("animation"):'';
  });
}
$(window).on("scroll", revealOnScroll);
$(document).ready(revealOnScroll)

// disqus scripts


// dropdown scripts
$(".dropdown").click(function(event) {
  var current = $(this);
  event.stopPropagation();
  $(current).children(".dropdown-content")[($(current).children(".dropdown-content").hasClass("open"))?'removeClass':'addClass']("open")
});
$(document).click(function(){
    $(".dropdown-content").removeClass("open");
})

// back to top scripts
$("a[href='#top']").click(function() {
  $("html, body").animate({ scrollTop: 0 }, 500);
  return false;
});


var path = "/search.xml";
searchFunc(path, 'local-search-input', 'local-search-result');

</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>
</html>
